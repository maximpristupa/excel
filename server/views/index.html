<!DOCTYPE html>
<html>
  <head>
      <title>Csv</title>
      <meta charset="utf-8" />
  </head>
  <body>

    <form name="person">
      <input type="file" name="myFile" onchange="upload(this.files[0])" />
    </form>

    <div id="table"></div>

    <script>
      function upload(file) {
          let formData = new FormData(document.forms.person);
          let xhr = new XMLHttpRequest();
          xhr.open("POST", "/uploadfile");
          xhr.send(formData);
          xhr.onload = () => printHtml(displayPage(xhr.response));
      }

      function displayPage(csv = null) {
          if (!csv) {
              return null;
          }
          csv = JSON.parse(csv)
          let html = ''
          html += '<form name="extable" class="extable">';
          csv.forEach((row) => {
              html += '<div class="row">';
              row.forEach((cell) => {
                  html += `<div class="cell" style="display:inline-block; margin: 10px; text-align: center;"> <input onkeydown = "if (event.keyCode == 13) document.getElementById('recalcButton').click()" type="text" name="cell" value="${cell}" style="width: 100px; height: 100px; font-size: 20px;"> </div>`;
              });
              html += '</div>';
          });
          html += `<input type="hidden" name="rowCount" value="${csv.length}">`;
          html += '<input onclick="calculate()" value="Recalculate" type="button" id="recalcButton"/>';
          html += '</form>';
          return html;
      }

      function printHtml(argument) {
          document.getElementById('table').innerHTML = argument;
      }

      function calculate() {
          let fd = new FormData(document.forms.extable);
          let xhr = new XMLHttpRequest();
          xhr.open("POST", "/calculate");
          xhr.send(fd);

          xhr.onload = () => printHtml(displayPage(xhr.response));
      }
    </script>

</body>
<html>